function calculateTariff() {
  const deficitRatio = parseFloat(document.getElementById('deficitRatio').value);
  const marketAccessGap = parseFloat(document.getElementById('marketAccessGap').value);
  const ppiGap = parseFloat(document.getElementById('ppiGap').value);
  const existingTariff = parseFloat(document.getElementById('existingTariff').value);
  const delta = parseFloat(document.getElementById('delta').value);

  const alpha = 0.4;
  const beta = 0.3;
  const gamma = 0.3;

  if ([deficitRatio, marketAccessGap, ppiGap, existingTariff, delta].some(isNaN)) {
    document.getElementById('result').textContent = "Please fill out all fields with valid numbers.";
    return;
  }

  // Correct formula implementation
  const rawTariff = (deficitRatio * alpha) + (marketAccessGap * beta) + (ppiGap * gamma);
  const devGapAdjustment = (1 - (ppiGap * delta));
  const finalTariff = (rawTariff * devGapAdjustment * 100) - existingTariff;

  document.getElementById('result').textContent = `Calculated Tariff Rate: ${finalTariff.toFixed(2)}%`;

  renderChart(deficitRatio * alpha * 100, marketAccessGap * beta * 100, ppiGap * gamma * 100, existingTariff);
}
